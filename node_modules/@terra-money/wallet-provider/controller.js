import { isDesktopChrome } from '@terra-dev/browser-check';
import { readonlyWalletModal } from '@terra-dev/readonly-wallet-modal';
import { ConnectType, WalletStatus, } from '@terra-dev/use-wallet';
import { CreateTxFailed, Timeout, TxFailed, TxUnspecifiedError, UserDenied, } from '@terra-dev/wallet-types';
import { WebConnectorController } from '@terra-dev/web-connector-controller';
import { WebConnectorCreateTxFailed, WebConnectorStatusType, WebConnectorTxFailed, WebConnectorTxStatus, WebConnectorUserDenied, } from '@terra-dev/web-connector-interface';
import { AccAddress, } from '@terra-money/terra.js';
import deepEqual from 'fast-deep-equal';
import { BehaviorSubject, combineLatest } from 'rxjs';
import { filter, map } from 'rxjs/operators';
import { CHROME_EXTENSION_INSTALL_URL, DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK, WEB_EXTENSION_CONNECTED_KEY, } from './env';
import { ChromeExtensionController, ChromeExtensionCreateTxFailed, ChromeExtensionStatus, ChromeExtensionTxFailed, ChromeExtensionUnspecifiedError, } from './modules/chrome-extension';
import { connect as reConnect, connectIfSessionExists as reConnectIfSessionExists, } from './modules/readonly-wallet';
import { connect as wcConnect, connectIfSessionExists as wcConnectIfSessionExists, WalletConnectCreateTxFailed, WalletConnectSessionStatus, WalletConnectTimeout, WalletConnectTxFailed, WalletConnectTxUnspecifiedError, WalletConnectUserDenied, } from './modules/walletconnect';
import { checkAvailableExtension } from './utils/checkAvailableExtension';
const defaultWaitingChromeExtensionInstallCheck = 1000 * 3;
export class WalletController {
    constructor(options) {
        var _a;
        this.options = options;
        this.chromeExtension = null;
        this.webConnector = null;
        this.walletConnect = null;
        this.readonlyWallet = null;
        this.disableReadonlyWallet = null;
        this.disableChromeExtension = null;
        this.disableWebExtension = null;
        this.disableWalletConnect = null;
        /** @see Wallet#isChromeExtensionCompatibleBrowser */
        this.isChromeExtensionCompatibleBrowser = () => {
            var _a;
            return ((_a = this.options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK)(navigator.userAgent);
        };
        /** @see Wallet#availableConnectTypes */
        this.availableConnectTypes = () => {
            return this._availableConnectTypes.asObservable();
        };
        /** @see Wallet#availableInstallTypes */
        this.availableInstallTypes = () => {
            return this._availableInstallTypes.asObservable();
        };
        /**
         * @see Wallet#status
         * @see Wallet#network
         * @see Wallet#wallets
         */
        this.states = () => {
            return this._states.asObservable();
        };
        /** @deprecated please use `states()` */
        this.status = () => {
            return this._states.pipe(map((data) => data.status));
        };
        /** @deprecated please use `states()` */
        this.network = () => {
            return this._states.pipe(map((data) => data.network));
        };
        /** @deprecated please use `states()` */
        this.wallets = () => {
            return this._states.pipe(map((data) => data.status === WalletStatus.WALLET_CONNECTED ? data.wallets : []));
        };
        /** @see Wallet#recheckStatus */
        this.recheckStatus = () => {
            var _a;
            if (this.disableChromeExtension) {
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.recheckStatus();
            }
        };
        /** @see Wallet#install */
        this.install = (type) => {
            var _a;
            if (type === ConnectType.CHROME_EXTENSION) {
                window.open(CHROME_EXTENSION_INSTALL_URL, '_blank');
            }
            else if (type === ConnectType.WEB_CONNECT) {
                const webExtensionStatus = (_a = this.webConnector) === null || _a === void 0 ? void 0 : _a.getLastStatus();
                if ((webExtensionStatus === null || webExtensionStatus === void 0 ? void 0 : webExtensionStatus.type) === WebConnectorStatusType.NO_AVAILABLE &&
                    webExtensionStatus.installLink) {
                    window.open(webExtensionStatus.installLink, '_blank');
                }
            }
            else {
                console.warn(`ConnectType "${type}" does not support install() function`);
            }
        };
        /** @see Wallet#connect */
        this.connect = (type) => {
            var _a, _b, _c;
            switch (type) {
                case ConnectType.READONLY:
                    const networks = Object.keys(this.options.walletConnectChainIds).map((chainId) => this.options.walletConnectChainIds[+chainId]);
                    const createReadonlyWalletSession = (_c = (_b = (_a = this.options).createReadonlyWalletSession) === null || _b === void 0 ? void 0 : _b.call(_a, networks)) !== null && _c !== void 0 ? _c : readonlyWalletModal({ networks });
                    createReadonlyWalletSession.then((readonlyWalletSession) => {
                        if (readonlyWalletSession) {
                            this.enableReadonlyWallet(reConnect(readonlyWalletSession));
                        }
                    });
                    break;
                case ConnectType.WALLETCONNECT:
                    this.enableWalletConnect(wcConnect(this.options));
                    break;
                case ConnectType.CHROME_EXTENSION:
                    this.chromeExtension.connect().then((success) => {
                        if (success) {
                            this.enableChromeExtension();
                        }
                    });
                    break;
                case ConnectType.WEB_CONNECT:
                    this.enableWebExtension();
                    break;
                default:
                    throw new Error(`Unknown ConnectType!`);
            }
        };
        /** @see Wallet#connectReadonly */
        this.connectReadonly = (terraAddress, network) => {
            this.enableReadonlyWallet(reConnect({
                terraAddress,
                network,
            }));
        };
        /** @see Wallet#disconnect */
        this.disconnect = () => {
            var _a, _b, _c, _d;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            this.disableReadonlyWallet = null;
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            this.disableChromeExtension = null;
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            this.disableWebExtension = null;
            (_d = this.disableWalletConnect) === null || _d === void 0 ? void 0 : _d.call(this);
            this.disableWalletConnect = null;
            localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
            this.updateStates(this._notConnected);
        };
        /** @see Wallet#post */
        this.post = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            // ---------------------------------------------
            // chrome extension - legacy extension
            // ---------------------------------------------
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return (this.chromeExtension
                    // TODO make WalletConnectTxResult to common type
                    .post(tx)
                    .then(({ payload }) => {
                    return {
                        ...tx,
                        result: payload.result,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof ChromeExtensionCreateTxFailed) {
                        throw new CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof ChromeExtensionTxFailed) {
                        throw new TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof ChromeExtensionUnspecifiedError) {
                        throw new TxUnspecifiedError(tx, error.message);
                    }
                    // UserDeniedError
                    // All unspecified errors...
                    throw error;
                }));
            }
            // ---------------------------------------------
            // web extension - new extension
            // ---------------------------------------------
            else if (this.disableWebExtension) {
                return new Promise((resolve, reject) => {
                    var _a, _b;
                    if (!this.webConnector) {
                        reject(new Error(`webExtension instance not created!`));
                        return;
                    }
                    const webExtensionStates = this.webConnector.getLastStates();
                    if (!webExtensionStates) {
                        reject(new Error(`webExtension.getLastStates() returns undefined!`));
                        return;
                    }
                    const focusedWallet = txTarget.terraAddress
                        ? (_a = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress === txTarget.terraAddress)) !== null && _a !== void 0 ? _a : webExtensionStates.wallets[0]
                        : webExtensionStates.focusedWalletAddress
                            ? (_b = webExtensionStates.wallets.find((itemWallet) => itemWallet.terraAddress ===
                                webExtensionStates.focusedWalletAddress)) !== null && _b !== void 0 ? _b : webExtensionStates.wallets[0]
                            : webExtensionStates.wallets[0];
                    const subscription = this.webConnector
                        .post(focusedWallet.terraAddress, tx)
                        .subscribe({
                        next: (extensionTxResult) => {
                            switch (extensionTxResult.status) {
                                case WebConnectorTxStatus.SUCCEED:
                                    resolve({
                                        ...tx,
                                        result: extensionTxResult.payload,
                                        success: true,
                                    });
                                    subscription.unsubscribe();
                                    break;
                            }
                        },
                        error: (error) => {
                            if (error instanceof WebConnectorUserDenied) {
                                reject(new UserDenied());
                            }
                            else if (error instanceof WebConnectorCreateTxFailed) {
                                reject(new CreateTxFailed(tx, error.message));
                            }
                            else if (error instanceof WebConnectorTxFailed) {
                                reject(new TxFailed(tx, error.txhash, error.message, error.raw_message));
                            }
                            else {
                                reject(new TxUnspecifiedError(tx, 'message' in error ? error.message : String(error)));
                            }
                            subscription.unsubscribe();
                        },
                    });
                });
            }
            // ---------------------------------------------
            // wallet connect
            // ---------------------------------------------
            else if (this.walletConnect) {
                return this.walletConnect
                    .post(tx)
                    .then((result) => ({
                    ...tx,
                    result,
                    success: true,
                }))
                    .catch((error) => {
                    let throwError = error;
                    try {
                        if (error instanceof WalletConnectUserDenied) {
                            throwError = new UserDenied();
                        }
                        else if (error instanceof WalletConnectCreateTxFailed) {
                            throwError = new CreateTxFailed(tx, error.message);
                        }
                        else if (error instanceof WalletConnectTxFailed) {
                            throwError = new TxFailed(tx, error.txhash, error.message, error.raw_message);
                        }
                        else if (error instanceof WalletConnectTimeout) {
                            throwError = new Timeout(error.message);
                        }
                        else if (error instanceof WalletConnectTxUnspecifiedError) {
                            throwError = new TxUnspecifiedError(tx, error.message);
                        }
                    }
                    catch (_a) {
                        throwError = new TxUnspecifiedError(tx, 'message' in error ? error.message : String(error));
                    }
                    throw throwError;
                });
            }
            else {
                throw new Error(`There are no connections that can be posting tx!`);
            }
        };
        /** @see Wallet#sign */
        this.sign = async (tx, 
        // TODO not work at this time. for the future extension
        txTarget = {}) => {
            if (this.disableChromeExtension) {
                if (!this.chromeExtension) {
                    throw new Error(`chromeExtension instance not created!`);
                }
                return this.chromeExtension
                    .sign(tx)
                    .then(({ payload }) => {
                    const publicKey = typeof payload.result.public_key === 'string'
                        ? {
                            type: 'tendermint/PubKeySecp256k1',
                            value: payload.result.public_key,
                        }
                        : payload.result.public_key;
                    const signResult = {
                        ...payload.result,
                        public_key: publicKey,
                    };
                    return {
                        ...tx,
                        result: signResult,
                        success: true,
                    };
                })
                    .catch((error) => {
                    if (error instanceof ChromeExtensionCreateTxFailed) {
                        throw new CreateTxFailed(tx, error.message);
                    }
                    else if (error instanceof ChromeExtensionTxFailed) {
                        throw new TxFailed(tx, error.txhash, error.message, null);
                    }
                    else if (error instanceof ChromeExtensionUnspecifiedError) {
                        throw new TxUnspecifiedError(tx, error.message);
                    }
                    // UserDenied - chrome extension will sent original UserDenied error type
                    // All unspecified errors...
                    throw error;
                });
            }
            throw new Error(`sign() method only available on chrome extension`);
            // TODO implements sign() to other connect types
        };
        // ================================================================
        // internal
        // connect type changing
        // ================================================================
        this.updateStates = (next) => {
            const prev = this._states.getValue();
            if (next.status === WalletStatus.WALLET_CONNECTED &&
                next.wallets.length === 0) {
                console.trace('???');
            }
            if (prev.status !== next.status || !deepEqual(prev, next)) {
                this._states.next(next);
            }
        };
        this.enableReadonlyWallet = (readonlyWallet) => {
            var _a, _b, _c, _d;
            (_a = this.disableWalletConnect) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.readonlyWallet === readonlyWallet ||
                (((_d = this.readonlyWallet) === null || _d === void 0 ? void 0 : _d.terraAddress) === readonlyWallet.terraAddress &&
                    this.readonlyWallet.network === readonlyWallet.network)) {
                return;
            }
            if (this.readonlyWallet) {
                this.readonlyWallet.disconnect();
            }
            this.readonlyWallet = readonlyWallet;
            this.updateStates({
                status: WalletStatus.WALLET_CONNECTED,
                network: readonlyWallet.network,
                wallets: [
                    {
                        connectType: ConnectType.READONLY,
                        terraAddress: readonlyWallet.terraAddress,
                        design: 'readonly',
                    },
                ],
            });
            this.disableReadonlyWallet = () => {
                readonlyWallet.disconnect();
                this.readonlyWallet = null;
                this.disableReadonlyWallet = null;
            };
        };
        this.enableWebExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableChromeExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableWebExtension || !this.webConnector) {
                return;
            }
            const extensionSubscription = combineLatest([
                this.webConnector.status(),
                this.webConnector.states(),
            ]).subscribe(([status, states]) => {
                var _a;
                if (!states) {
                    return;
                }
                if (status.type === WebConnectorStatusType.READY) {
                    if (states.wallets.length > 0) {
                        const focusedWallet = states.focusedWalletAddress
                            ? (_a = states.wallets.find((itemWallet) => itemWallet.terraAddress === states.focusedWalletAddress)) !== null && _a !== void 0 ? _a : states.wallets[0]
                            : states.wallets[0];
                        this.updateStates({
                            status: WalletStatus.WALLET_CONNECTED,
                            network: states.network,
                            wallets: [
                                {
                                    connectType: ConnectType.WEB_CONNECT,
                                    terraAddress: focusedWallet.terraAddress,
                                    design: focusedWallet.design,
                                },
                            ],
                        });
                    }
                }
                else if (status.type === WebConnectorStatusType.NO_AVAILABLE) {
                    localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                    this.updateStates(this._notConnected);
                    if (!status.isApproved && this.disableWebExtension) {
                        this.disableWebExtension();
                    }
                }
            });
            localStorage.setItem(WEB_EXTENSION_CONNECTED_KEY, 'true');
            const lastExtensionStatus = this.webConnector.getLastStatus();
            if (lastExtensionStatus.type === WebConnectorStatusType.NO_AVAILABLE &&
                lastExtensionStatus.isApproved === false) {
                this.webConnector.requestApproval();
            }
            this.disableWebExtension = () => {
                localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                extensionSubscription.unsubscribe();
                this.disableWebExtension = null;
            };
        };
        this.enableChromeExtension = () => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableWalletConnect) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.disableChromeExtension || !this.chromeExtension) {
                return;
            }
            const extensionSubscription = combineLatest([
                this.chromeExtension.status(),
                this.chromeExtension.networkInfo(),
                this.chromeExtension.terraAddress(),
            ]).subscribe({
                next: ([status, networkInfo, terraAddress]) => {
                    if (status === ChromeExtensionStatus.WALLET_CONNECTED &&
                        typeof terraAddress === 'string' &&
                        AccAddress.validate(terraAddress)) {
                        this.updateStates({
                            status: WalletStatus.WALLET_CONNECTED,
                            network: networkInfo,
                            wallets: [
                                {
                                    connectType: ConnectType.CHROME_EXTENSION,
                                    terraAddress,
                                    design: 'extension',
                                },
                            ],
                        });
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                },
            });
            this.disableChromeExtension = () => {
                var _a;
                (_a = this.chromeExtension) === null || _a === void 0 ? void 0 : _a.disconnect();
                extensionSubscription.unsubscribe();
                this.disableChromeExtension = null;
            };
        };
        this.enableWalletConnect = (walletConnect) => {
            var _a, _b, _c;
            (_a = this.disableReadonlyWallet) === null || _a === void 0 ? void 0 : _a.call(this);
            (_b = this.disableChromeExtension) === null || _b === void 0 ? void 0 : _b.call(this);
            (_c = this.disableWebExtension) === null || _c === void 0 ? void 0 : _c.call(this);
            if (this.walletConnect === walletConnect) {
                return;
            }
            if (this.walletConnect) {
                this.walletConnect.disconnect();
            }
            this.walletConnect = walletConnect;
            const subscribeWalletConnect = (wc) => {
                return wc.session().subscribe({
                    next: (status) => {
                        var _a;
                        switch (status.status) {
                            case WalletConnectSessionStatus.CONNECTED:
                                this.updateStates({
                                    status: WalletStatus.WALLET_CONNECTED,
                                    network: (_a = this.options.walletConnectChainIds[status.chainId]) !== null && _a !== void 0 ? _a : this.options.defaultNetwork,
                                    wallets: [
                                        {
                                            connectType: ConnectType.WALLETCONNECT,
                                            terraAddress: status.terraAddress,
                                            design: 'walletconnect',
                                        },
                                    ],
                                });
                                break;
                            default:
                                this.updateStates(this._notConnected);
                                break;
                        }
                    },
                });
            };
            const walletConnectSessionSubscription = subscribeWalletConnect(walletConnect);
            this.disableWalletConnect = () => {
                var _a;
                (_a = this.walletConnect) === null || _a === void 0 ? void 0 : _a.disconnect();
                this.walletConnect = null;
                walletConnectSessionSubscription.unsubscribe();
                this.disableWalletConnect = null;
            };
        };
        this._notConnected = {
            status: WalletStatus.WALLET_NOT_CONNECTED,
            network: options.defaultNetwork,
        };
        this._initializing = {
            status: WalletStatus.INITIALIZING,
            network: options.defaultNetwork,
        };
        this._availableConnectTypes = new BehaviorSubject([
            ConnectType.READONLY,
            ConnectType.WALLETCONNECT,
        ]);
        this._availableInstallTypes = new BehaviorSubject([]);
        this._states = new BehaviorSubject(this._initializing);
        let numSessionCheck = 0;
        // wait checking the availability of the chrome extension
        // 0. check if extension wallet session is exists
        checkAvailableExtension((_a = options.waitingChromeExtensionInstallCheck) !== null && _a !== void 0 ? _a : defaultWaitingChromeExtensionInstallCheck, this.isChromeExtensionCompatibleBrowser()).then((extensionType) => {
            var _a;
            if (extensionType === ConnectType.WEB_CONNECT) {
                this._availableConnectTypes.next([
                    ConnectType.READONLY,
                    ConnectType.WEB_CONNECT,
                    ConnectType.WALLETCONNECT,
                ]);
                this.webConnector = new WebConnectorController(window);
                const subscription = this.webConnector
                    .status()
                    .pipe(filter((webExtensionStatus) => {
                    return (webExtensionStatus.type !== WebConnectorStatusType.INITIALIZING);
                }))
                    .subscribe((webExtensionStatus) => {
                    subscription.unsubscribe();
                    if (webExtensionStatus.type === WebConnectorStatusType.READY &&
                        localStorage.getItem(WEB_EXTENSION_CONNECTED_KEY) === 'true' &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableWebExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                        localStorage.removeItem(WEB_EXTENSION_CONNECTED_KEY);
                    }
                });
            }
            else if (extensionType === ConnectType.CHROME_EXTENSION) {
                this._availableConnectTypes.next([
                    ConnectType.READONLY,
                    ConnectType.CHROME_EXTENSION,
                    ConnectType.WALLETCONNECT,
                ]);
                this.chromeExtension = new ChromeExtensionController({
                    enableWalletConnection: true,
                    defaultNetwork: options.defaultNetwork,
                    dangerously__chromeExtensionCompatibleBrowserCheck: (_a = options.dangerously__chromeExtensionCompatibleBrowserCheck) !== null && _a !== void 0 ? _a : DEFAULT_CHROME_EXTENSION_COMPATIBLE_BROWSER_CHECK,
                });
                const subscription = this.chromeExtension
                    .status()
                    .pipe(filter((chromeExtensionStatus) => {
                    return (chromeExtensionStatus !== ChromeExtensionStatus.INITIALIZING);
                }))
                    .subscribe((chromeExtensionStatus) => {
                    try {
                        subscription.unsubscribe();
                    }
                    catch (_a) { }
                    if (chromeExtensionStatus ===
                        ChromeExtensionStatus.WALLET_CONNECTED &&
                        !this.disableWalletConnect &&
                        !this.disableReadonlyWallet) {
                        this.enableChromeExtension();
                    }
                    else if (numSessionCheck === 0) {
                        numSessionCheck += 1;
                    }
                    else {
                        this.updateStates(this._notConnected);
                    }
                });
            }
            else {
                if (isDesktopChrome(this.isChromeExtensionCompatibleBrowser())) {
                    this._availableInstallTypes.next([ConnectType.CHROME_EXTENSION]);
                }
                if (numSessionCheck === 0) {
                    numSessionCheck += 1;
                }
                else {
                    this.updateStates(this._notConnected);
                }
            }
        });
        // 1. check if readonly wallet session is exists
        const draftReadonlyWallet = reConnectIfSessionExists();
        if (draftReadonlyWallet) {
            this.enableReadonlyWallet(draftReadonlyWallet);
            return;
        }
        // 2. check if walletconnect sesison is exists
        const draftWalletConnect = wcConnectIfSessionExists(options);
        if (draftWalletConnect &&
            draftWalletConnect.getLatestSession().status ===
                WalletConnectSessionStatus.CONNECTED) {
            this.enableWalletConnect(draftWalletConnect);
        }
        else if (numSessionCheck === 0) {
            numSessionCheck += 1;
        }
        else {
            this.updateStates(this._notConnected);
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udHJvbGxlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9AdGVycmEtbW9uZXkvd2FsbGV0LXByb3ZpZGVyL2NvbnRyb2xsZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQzNELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQ3ZFLE9BQU8sRUFDTCxXQUFXLEVBSVgsWUFBWSxHQUNiLE1BQU0sdUJBQXVCLENBQUM7QUFDL0IsT0FBTyxFQUNMLGNBQWMsRUFHZCxPQUFPLEVBQ1AsUUFBUSxFQUNSLGtCQUFrQixFQUNsQixVQUFVLEdBQ1gsTUFBTSx5QkFBeUIsQ0FBQztBQUNqQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUM3RSxPQUFPLEVBQ0wsMEJBQTBCLEVBQzFCLHNCQUFzQixFQUN0QixvQkFBb0IsRUFFcEIsb0JBQW9CLEVBQ3BCLHNCQUFzQixHQUN2QixNQUFNLG9DQUFvQyxDQUFDO0FBQzVDLE9BQU8sRUFDTCxVQUFVLEdBSVgsTUFBTSx1QkFBdUIsQ0FBQztBQUMvQixPQUFPLFNBQVMsTUFBTSxpQkFBaUIsQ0FBQztBQUN4QyxPQUFPLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBNEIsTUFBTSxNQUFNLENBQUM7QUFDaEYsT0FBTyxFQUFFLE1BQU0sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQ0wsNEJBQTRCLEVBQzVCLGlEQUFpRCxFQUNqRCwyQkFBMkIsR0FDNUIsTUFBTSxPQUFPLENBQUM7QUFDZixPQUFPLEVBQ0wseUJBQXlCLEVBQ3pCLDZCQUE2QixFQUM3QixxQkFBcUIsRUFDckIsdUJBQXVCLEVBQ3ZCLCtCQUErQixHQUNoQyxNQUFNLDRCQUE0QixDQUFDO0FBQ3BDLE9BQU8sRUFDTCxPQUFPLElBQUksU0FBUyxFQUNwQixz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QUFlLEtBQUssQ0FBQyxFQUFFO29CQUN6QixlQUFlLElBQUksQ0FBQyxDQUFDO2lCQUN0QjtxQkFBTTtvQkFDTCxJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQztpQkFDdkM7YUFDRjtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsZ0RBQWdEO1FBQ2hELE1BQU0sbUJBQW1CLEdBQUcsd0JBQXdCLEVBQUUsQ0FBQztRQUV2RCxJQUFJLG1CQUFtQixFQUFFO1lBQ3ZCLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQy9DLE9BQU87U0FDUjtRQUVELDhDQUE4QztRQUM5QyxNQUFNLGtCQUFrQixHQUFHLHdCQUF3QixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTdELElBQ0Usa0JBQWtCO1lBQ2xCLGtCQUFrQixDQUFDLGdCQUFnQixFQUFFLENBQUMsTUFBTTtnQkFDMUMsMEJBQTBCLENBQUMsU0FBUyxFQUN0QztZQUNBLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1NBQzlDO2FBQU0sSUFBSSxlQUFlLEtBQUssQ0FBQyxFQUFFO1lBQ2hDLGVBQWUsSUFBSSxDQUFDLENBQUM7U0FDdEI7YUFBTTtZQUNMLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1NBQ3ZDO0lBQ0gsQ0FBQztDQWdrQkYiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBpc0Rlc2t0b3BDaHJvbWUgfSBmcm9tICdAdGVycmEtZGV2L2Jyb3dzZXItY2hlY2snO1xuaW1wb3J0IHsgcmVhZG9ubHlXYWxsZXRNb2RhbCB9IGZyb20gJ0B0ZXJyYS1kZXYvcmVhZG9ubHktd2FsbGV0LW1vZGFsJztcbmltcG9ydCB7XG4gIENvbm5lY3RUeXBlLFxuICBUeFJlc3VsdCxcbiAgV2FsbGV0SW5mbyxcbiAgV2FsbGV0U3RhdGVzLFxuICBXYWxsZXRTdGF0dXMsXG59IGZyb20gJ0B0ZXJyYS1kZXYvdXNlLXdhbGxldCc7XG5pbXBvcnQge1xuICBDcmVhdGVUeEZhaWxlZCxcbiAgTmV0d29ya0luZm8sXG4gIFNpZ25SZXN1bHQsXG4gIFRpbWVvdXQsXG4gIFR4RmFpbGVkLFxuICBUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFVzZXJEZW5pZWQsXG59IGZyb20gJ0B0ZXJyYS1kZXYvd2FsbGV0LXR5cGVzJztcbmltcG9ydCB7IFdlYkNvbm5lY3RvckNvbnRyb2xsZXIgfSBmcm9tICdAdGVycmEtZGV2L3dlYi1jb25uZWN0b3ItY29udHJvbGxlcic7XG5pbXBvcnQge1xuICBXZWJDb25uZWN0b3JDcmVhdGVUeEZhaWxlZCxcbiAgV2ViQ29ubmVjdG9yU3RhdHVzVHlwZSxcbiAgV2ViQ29ubmVjdG9yVHhGYWlsZWQsXG4gIFdlYkNvbm5lY3RvclR4UmVzdWx0LFxuICBXZWJDb25uZWN0b3JUeFN0YXR1cyxcbiAgV2ViQ29ubmVjdG9yVXNlckRlbmllZCxcbn0gZnJvbSAnQHRlcnJhLWRldi93ZWItY29ubmVjdG9yLWludGVyZmFjZSc7XG5pbXBvcnQge1xuICBBY2NBZGRyZXNzLFxuICBDcmVhdGVUeE9wdGlvbnMsXG4gIFB1YmxpY0tleSxcbiAgU3RkU2lnbk1zZyxcbn0gZnJvbSAnQHRlcnJhLW1vbmV5L3RlcnJhLmpzJztcbmltcG9ydCBkZWVwRXF1YWwgZnJvbSAnZmFzdC1kZWVwLWVxdWFsJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgY29tYmluZUxhdGVzdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIG1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7XG4gIENIUk9NRV9FWFRFTlNJT05fSU5TVEFMTF9VUkwsXG4gIERFRkFVTFRfQ0hST01FX0VYVEVOU0lPTl9DT01QQVRJQkxFX0JST1dTRVJfQ0hFQ0ssXG4gIFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSxcbn0gZnJvbSAnLi9lbnYnO1xuaW1wb3J0IHtcbiAgQ2hyb21lRXh0ZW5zaW9uQ29udHJvbGxlcixcbiAgQ2hyb21lRXh0ZW5zaW9uQ3JlYXRlVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblN0YXR1cyxcbiAgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQsXG4gIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IsXG59IGZyb20gJy4vbW9kdWxlcy9jaHJvbWUtZXh0ZW5zaW9uJztcbmltcG9ydCB7XG4gIGNvbm5lY3QgYXMgcmVDb25uZWN0LFxuICBjb25uZWN0SWZTZXNzaW9uRXhpc3RzIGFzIHJlQ29ubmVjdElmU2Vzc2lvbkV4aXN0cyxcbiAgUmVhZG9ubHlXYWxsZXRDb250cm9sbGVyLFxuICBSZWFkb25seVdhbGxldFNlc3Npb24sXG59IGZyb20gJy4vbW9kdWxlcy9yZWFkb25seS13YWxsZXQnO1xuaW1wb3J0IHtcbiAgY29ubmVjdCBhcyB3Y0Nvbm5lY3QsXG4gIGNvbm5lY3RJZlNlc3Npb25FeGlzdHMgYXMgd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzLFxuICBXYWxsZXRDb25uZWN0Q29udHJvbGxlcixcbiAgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zLFxuICBXYWxsZXRDb25uZWN0Q3JlYXRlVHhGYWlsZWQsXG4gIFdhbGxldENvbm5lY3RTZXNzaW9uU3RhdHVzLFxuICBXYWxsZXRDb25uZWN0VGltZW91dCxcbiAgV2FsbGV0Q29ubmVjdFR4RmFpbGVkLFxuICBXYWxsZXRDb25uZWN0VHhSZXN1bHQsXG4gIFdhbGxldENvbm5lY3RUeFVuc3BlY2lmaWVkRXJyb3IsXG4gIFdhbGxldENvbm5lY3RVc2VyRGVuaWVkLFxufSBmcm9tICcuL21vZHVsZXMvd2FsbGV0Y29ubmVjdCc7XG5pbXBvcnQgeyBjaGVja0F2YWlsYWJsZUV4dGVuc2lvbiB9IGZyb20gJy4vdXRpbHMvY2hlY2tBdmFpbGFibGVFeHRlbnNpb24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdhbGxldENvbnRyb2xsZXJPcHRpb25zXG4gIGV4dGVuZHMgV2FsbGV0Q29ubmVjdENvbnRyb2xsZXJPcHRpb25zIHtcbiAgLyoqXG4gICAqIOKaoO+4jyBEb24ndCBoYXJkY29kaW5nIHRoaXMsIHVzZSBnZXRDaGFpbiBPcHRpb25zKClcbiAgICpcbiAgICogZmFsbGJhY2sgbmV0d29yayBpZiBjb250cm9sbGVyIGlzIG5vdCBjb25uZWN0ZWRcbiAgICovXG4gIGRlZmF1bHROZXR3b3JrOiBOZXR3b3JrSW5mbztcblxuICAvKipcbiAgICog4pqg77iPIERvbid0IGhhcmRjb2RpbmcgdGhpcywgdXNlIGdldENoYWluIE9wdGlvbnMoKVxuICAgKlxuICAgKiBmb3Igd2FsbGV0Y29ubmVjdFxuICAgKlxuICAgKiBUaGUgbmV0d29yayBydWxlcyBwYXNzZWQgYnkgdGhlIFRlcnJhIFN0YXRpb24gTW9iaWxlIGFyZSAwIGlzIHRlc3RuZXQsIDEgaXMgbWFpbm5ldC5cbiAgICpcbiAgICogQWx3YXlzIHNldCB0ZXN0bmV0IGZvciAwIGFuZCBtYWlubmV0IGZvciAxLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogY29uc3QgbWFpbm5ldDogTmV0d29ya0luZm8gPSB7XG4gICAqICBuYW1lOiAnbWFpbm5ldCcsXG4gICAqICBjaGFpbklEOiAnY29sdW1idXMtNScsXG4gICAqICBsY2Q6ICdodHRwczovL2xjZC50ZXJyYS5kZXYnLFxuICAgKiB9XG4gICAqXG4gICAqIGNvbnN0IHRlc3RuZXQ6IE5ldHdvcmtJbmZvID0ge1xuICAgKiAgbmFtZTogJ3Rlc3RuZXQnLFxuICAgKiAgY2hhaW5JRDogJ2JvbWJheS0xMicsXG4gICAqICBsY2Q6ICdodHRwczovL2JvbWJheS1sY2QudGVycmEuZGV2JyxcbiAgICogfVxuICAgKlxuICAgKiBjb25zdCB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPiA9IHtcbiAgICogICAwOiB0ZXN0bmV0LFxuICAgKiAgIDE6IG1haW5uZXQsXG4gICAqIH1cbiAgICpcbiAgICogPFdhbGxldFByb3ZpZGVyIHdhbGxldENvbm5lY3RDaGFpbklkcz17d2FsbGV0Q29ubmVjdENoYWluSWRzfT5cbiAgICogYGBgXG4gICAqL1xuICB3YWxsZXRDb25uZWN0Q2hhaW5JZHM6IFJlY29yZDxudW1iZXIsIE5ldHdvcmtJbmZvPjtcblxuICAvKipcbiAgICogcnVuIGF0IGV4ZWN1dGluZyB0aGUgYGNvbm5lY3QoQ29ubmVjdFR5cGUuUkVBRE9OTFkpYFxuICAgKi9cbiAgY3JlYXRlUmVhZG9ubHlXYWxsZXRTZXNzaW9uPzogKFxuICAgIG5ldHdvcmtzOiBOZXR3b3JrSW5mb1tdLFxuICApID0+IFByb21pc2U8UmVhZG9ubHlXYWxsZXRTZXNzaW9uIHwgbnVsbD47XG5cbiAgLyoqXG4gICAqIG1pbGxpc2Vjb25kcyB0byB3YWl0IGNoZWNraW5nIGNocm9tZSBleHRlbnNpb24gaXMgaW5zdGFsbGVkXG4gICAqXG4gICAqIEBkZWZhdWx0IDEwMDAgKiAzIG1pbGlzZWNvbmRzXG4gICAqL1xuICB3YWl0aW5nQ2hyb21lRXh0ZW5zaW9uSW5zdGFsbENoZWNrPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiDimqDvuI8gVGhpcyBBUEkgaXMgYW4gb3B0aW9uIGZvciB3YWxsZXQgZGV2ZWxvcGVycy4gUGxlYXNlIGRvbid0IHVzZSBkQXBwIGRldmVsb3BlcnMuXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYFxuICAgKiA8V2FsbGV0UHJvdmlkZXIgZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2s9eyh1c2VyQWdlbnQ6IHN0cmluZykgPT4ge1xuICAgKiAgIHJldHVybiAvTXlXYWxsZXRcXC8vLnRlc3QodXNlckFnZW50KTtcbiAgICogfX0+XG4gICAqIGBgYFxuICAgKi9cbiAgZGFuZ2Vyb3VzbHlfX2Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyQ2hlY2s/OiAoXG4gICAgdXNlckFnZW50OiBzdHJpbmcsXG4gICkgPT4gYm9vbGVhbjtcbn1cblxuY29uc3QgZGVmYXVsdFdhaXRpbmdDaHJvbWVFeHRlbnNpb25JbnN0YWxsQ2hlY2sgPSAxMDAwICogMztcblxuZXhwb3J0IGNsYXNzIFdhbGxldENvbnRyb2xsZXIge1xuICBwcml2YXRlIGNocm9tZUV4dGVuc2lvbjogQ2hyb21lRXh0ZW5zaW9uQ29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHdlYkNvbm5lY3RvcjogV2ViQ29ubmVjdG9yQ29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHdhbGxldENvbm5lY3Q6IFdhbGxldENvbm5lY3RDb250cm9sbGVyIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHlXYWxsZXQ6IFJlYWRvbmx5V2FsbGV0Q29udHJvbGxlciB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgX2F2YWlsYWJsZUNvbm5lY3RUeXBlczogQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+O1xuICBwcml2YXRlIF9hdmFpbGFibGVJbnN0YWxsVHlwZXM6IEJlaGF2aW9yU3ViamVjdDxDb25uZWN0VHlwZVtdPjtcbiAgcHJpdmF0ZSBfc3RhdGVzOiBCZWhhdmlvclN1YmplY3Q8V2FsbGV0U3RhdGVzPjtcblxuICBwcml2YXRlIGRpc2FibGVSZWFkb25seVdhbGxldDogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGlzYWJsZUNocm9tZUV4dGVuc2lvbjogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGlzYWJsZVdlYkV4dGVuc2lvbjogKCgpID0+IHZvaWQpIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgZGlzYWJsZVdhbGxldENvbm5lY3Q6ICgoKSA9PiB2b2lkKSB8IG51bGwgPSBudWxsO1xuXG4gIHByaXZhdGUgcmVhZG9ubHkgX25vdENvbm5lY3RlZDogV2FsbGV0U3RhdGVzO1xuICBwcml2YXRlIHJlYWRvbmx5IF9pbml0aWFsaXppbmc6IFdhbGxldFN0YXRlcztcblxuICBjb25zdHJ1Y3RvcihyZWFkb25seSBvcHRpb25zOiBXYWxsZXRDb250cm9sbGVyT3B0aW9ucykge1xuICAgIHRoaXMuX25vdENvbm5lY3RlZCA9IHtcbiAgICAgIHN0YXR1czogV2FsbGV0U3RhdHVzLldBTExFVF9OT1RfQ09OTkVDVEVELFxuICAgICAgbmV0d29yazogb3B0aW9ucy5kZWZhdWx0TmV0d29yayxcbiAgICB9O1xuXG4gICAgdGhpcy5faW5pdGlhbGl6aW5nID0ge1xuICAgICAgc3RhdHVzOiBXYWxsZXRTdGF0dXMuSU5JVElBTElaSU5HLFxuICAgICAgbmV0d29yazogb3B0aW9ucy5kZWZhdWx0TmV0d29yayxcbiAgICB9O1xuXG4gICAgdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzID0gbmV3IEJlaGF2aW9yU3ViamVjdDxDb25uZWN0VHlwZVtdPihbXG4gICAgICBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgXSk7XG5cbiAgICB0aGlzLl9hdmFpbGFibGVJbnN0YWxsVHlwZXMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PENvbm5lY3RUeXBlW10+KFtdKTtcblxuICAgIHRoaXMuX3N0YXRlcyA9IG5ldyBCZWhhdmlvclN1YmplY3Q8V2FsbGV0U3RhdGVzPih0aGlzLl9pbml0aWFsaXppbmcpO1xuXG4gICAgbGV0IG51bVNlc3Npb25DaGVjazogbnVtYmVyID0gMDtcblxuICAgIC8vIHdhaXQgY2hlY2tpbmcgdGhlIGF2YWlsYWJpbGl0eSBvZiB0aGUgY2hyb21lIGV4dGVuc2lvblxuICAgIC8vIDAuIGNoZWNrIGlmIGV4dGVuc2lvbiB3YWxsZXQgc2Vzc2lvbiBpcyBleGlzdHNcbiAgICBjaGVja0F2YWlsYWJsZUV4dGVuc2lvbihcbiAgICAgIG9wdGlvbnMud2FpdGluZ0Nocm9tZUV4dGVuc2lvbkluc3RhbGxDaGVjayA/P1xuICAgICAgICBkZWZhdWx0V2FpdGluZ0Nocm9tZUV4dGVuc2lvbkluc3RhbGxDaGVjayxcbiAgICAgIHRoaXMuaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlcigpLFxuICAgICkudGhlbigoZXh0ZW5zaW9uVHlwZSkgPT4ge1xuICAgICAgaWYgKGV4dGVuc2lvblR5cGUgPT09IENvbm5lY3RUeXBlLldFQl9DT05ORUNUKSB7XG4gICAgICAgIHRoaXMuX2F2YWlsYWJsZUNvbm5lY3RUeXBlcy5uZXh0KFtcbiAgICAgICAgICBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICBDb25uZWN0VHlwZS5XRUJfQ09OTkVDVCxcbiAgICAgICAgICBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgICAgICBdKTtcblxuICAgICAgICB0aGlzLndlYkNvbm5lY3RvciA9IG5ldyBXZWJDb25uZWN0b3JDb250cm9sbGVyKHdpbmRvdyk7XG5cbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy53ZWJDb25uZWN0b3JcbiAgICAgICAgICAuc3RhdHVzKClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGZpbHRlcigod2ViRXh0ZW5zaW9uU3RhdHVzKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgd2ViRXh0ZW5zaW9uU3RhdHVzLnR5cGUgIT09IFdlYkNvbm5lY3RvclN0YXR1c1R5cGUuSU5JVElBTElaSU5HXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnN1YnNjcmliZSgod2ViRXh0ZW5zaW9uU3RhdHVzKSA9PiB7XG4gICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5SRUFEWSAmJlxuICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVkpID09PSAndHJ1ZScgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3QgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5lbmFibGVXZWJFeHRlbnNpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICAgICAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoZXh0ZW5zaW9uVHlwZSA9PT0gQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTikge1xuICAgICAgICB0aGlzLl9hdmFpbGFibGVDb25uZWN0VHlwZXMubmV4dChbXG4gICAgICAgICAgQ29ubmVjdFR5cGUuUkVBRE9OTFksXG4gICAgICAgICAgQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTixcbiAgICAgICAgICBDb25uZWN0VHlwZS5XQUxMRVRDT05ORUNULFxuICAgICAgICBdKTtcblxuICAgICAgICB0aGlzLmNocm9tZUV4dGVuc2lvbiA9IG5ldyBDaHJvbWVFeHRlbnNpb25Db250cm9sbGVyKHtcbiAgICAgICAgICBlbmFibGVXYWxsZXRDb25uZWN0aW9uOiB0cnVlLFxuICAgICAgICAgIGRlZmF1bHROZXR3b3JrOiBvcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICAgIGRhbmdlcm91c2x5X19jaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlckNoZWNrOlxuICAgICAgICAgICAgb3B0aW9ucy5kYW5nZXJvdXNseV9fY2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXJDaGVjayA/P1xuICAgICAgICAgICAgREVGQVVMVF9DSFJPTUVfRVhURU5TSU9OX0NPTVBBVElCTEVfQlJPV1NFUl9DSEVDSyxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3Qgc3Vic2NyaXB0aW9uID0gdGhpcy5jaHJvbWVFeHRlbnNpb25cbiAgICAgICAgICAuc3RhdHVzKClcbiAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgIGZpbHRlcigoY2hyb21lRXh0ZW5zaW9uU3RhdHVzKSA9PiB7XG4gICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgY2hyb21lRXh0ZW5zaW9uU3RhdHVzICE9PSBDaHJvbWVFeHRlbnNpb25TdGF0dXMuSU5JVElBTElaSU5HXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApXG4gICAgICAgICAgLnN1YnNjcmliZSgoY2hyb21lRXh0ZW5zaW9uU3RhdHVzKSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0gY2F0Y2gge31cblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICBjaHJvbWVFeHRlbnNpb25TdGF0dXMgPT09XG4gICAgICAgICAgICAgICAgQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3QgJiZcbiAgICAgICAgICAgICAgIXRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdGhpcy5lbmFibGVDaHJvbWVFeHRlbnNpb24oKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobnVtU2Vzc2lvbkNoZWNrID09PSAwKSB7XG4gICAgICAgICAgICAgIG51bVNlc3Npb25DaGVjayArPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc0Rlc2t0b3BDaHJvbWUodGhpcy5pc0Nocm9tZUV4dGVuc2lvbkNvbXBhdGlibGVCcm93c2VyKCkpKSB7XG4gICAgICAgICAgdGhpcy5fYXZhaWxhYmxlSW5zdGFsbFR5cGVzLm5leHQoW0Nvbm5lY3RUeXBlLkNIUk9NRV9FWFRFTlNJT05dKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChudW1TZXNzaW9uQ2hlY2sgPT09IDApIHtcbiAgICAgICAgICBudW1TZXNzaW9uQ2hlY2sgKz0gMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh0aGlzLl9ub3RDb25uZWN0ZWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyAxLiBjaGVjayBpZiByZWFkb25seSB3YWxsZXQgc2Vzc2lvbiBpcyBleGlzdHNcbiAgICBjb25zdCBkcmFmdFJlYWRvbmx5V2FsbGV0ID0gcmVDb25uZWN0SWZTZXNzaW9uRXhpc3RzKCk7XG5cbiAgICBpZiAoZHJhZnRSZWFkb25seVdhbGxldCkge1xuICAgICAgdGhpcy5lbmFibGVSZWFkb25seVdhbGxldChkcmFmdFJlYWRvbmx5V2FsbGV0KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyAyLiBjaGVjayBpZiB3YWxsZXRjb25uZWN0IHNlc2lzb24gaXMgZXhpc3RzXG4gICAgY29uc3QgZHJhZnRXYWxsZXRDb25uZWN0ID0gd2NDb25uZWN0SWZTZXNzaW9uRXhpc3RzKG9wdGlvbnMpO1xuXG4gICAgaWYgKFxuICAgICAgZHJhZnRXYWxsZXRDb25uZWN0ICYmXG4gICAgICBkcmFmdFdhbGxldENvbm5lY3QuZ2V0TGF0ZXN0U2Vzc2lvbigpLnN0YXR1cyA9PT1cbiAgICAgICAgV2FsbGV0Q29ubmVjdFNlc3Npb25TdGF0dXMuQ09OTkVDVEVEXG4gICAgKSB7XG4gICAgICB0aGlzLmVuYWJsZVdhbGxldENvbm5lY3QoZHJhZnRXYWxsZXRDb25uZWN0KTtcbiAgICB9IGVsc2UgaWYgKG51bVNlc3Npb25DaGVjayA9PT0gMCkge1xuICAgICAgbnVtU2Vzc2lvbkNoZWNrICs9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2lzQ2hyb21lRXh0ZW5zaW9uQ29tcGF0aWJsZUJyb3dzZXIgKi9cbiAgaXNDaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlciA9ICgpOiBib29sZWFuID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5vcHRpb25zLmRhbmdlcm91c2x5X19jaHJvbWVFeHRlbnNpb25Db21wYXRpYmxlQnJvd3NlckNoZWNrID8/XG4gICAgICBERUZBVUxUX0NIUk9NRV9FWFRFTlNJT05fQ09NUEFUSUJMRV9CUk9XU0VSX0NIRUNLXG4gICAgKShuYXZpZ2F0b3IudXNlckFnZW50KTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjYXZhaWxhYmxlQ29ubmVjdFR5cGVzICovXG4gIGF2YWlsYWJsZUNvbm5lY3RUeXBlcyA9ICgpOiBPYnNlcnZhYmxlPENvbm5lY3RUeXBlW10+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fYXZhaWxhYmxlQ29ubmVjdFR5cGVzLmFzT2JzZXJ2YWJsZSgpO1xuICB9O1xuXG4gIC8qKiBAc2VlIFdhbGxldCNhdmFpbGFibGVJbnN0YWxsVHlwZXMgKi9cbiAgYXZhaWxhYmxlSW5zdGFsbFR5cGVzID0gKCk6IE9ic2VydmFibGU8Q29ubmVjdFR5cGVbXT4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9hdmFpbGFibGVJbnN0YWxsVHlwZXMuYXNPYnNlcnZhYmxlKCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBzZWUgV2FsbGV0I3N0YXR1c1xuICAgKiBAc2VlIFdhbGxldCNuZXR3b3JrXG4gICAqIEBzZWUgV2FsbGV0I3dhbGxldHNcbiAgICovXG4gIHN0YXRlcyA9ICgpOiBPYnNlcnZhYmxlPFdhbGxldFN0YXRlcz4gPT4ge1xuICAgIHJldHVybiB0aGlzLl9zdGF0ZXMuYXNPYnNlcnZhYmxlKCk7XG4gIH07XG5cbiAgLyoqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgYHN0YXRlcygpYCAqL1xuICBzdGF0dXMgPSAoKTogT2JzZXJ2YWJsZTxXYWxsZXRTdGF0dXM+ID0+IHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdGVzLnBpcGUobWFwKChkYXRhKSA9PiBkYXRhLnN0YXR1cykpO1xuICB9O1xuXG4gIC8qKiBAZGVwcmVjYXRlZCBwbGVhc2UgdXNlIGBzdGF0ZXMoKWAgKi9cbiAgbmV0d29yayA9ICgpOiBPYnNlcnZhYmxlPE5ldHdvcmtJbmZvPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5waXBlKG1hcCgoZGF0YSkgPT4gZGF0YS5uZXR3b3JrKSk7XG4gIH07XG5cbiAgLyoqIEBkZXByZWNhdGVkIHBsZWFzZSB1c2UgYHN0YXRlcygpYCAqL1xuICB3YWxsZXRzID0gKCk6IE9ic2VydmFibGU8V2FsbGV0SW5mb1tdPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXRlcy5waXBlKFxuICAgICAgbWFwKChkYXRhKSA9PlxuICAgICAgICBkYXRhLnN0YXR1cyA9PT0gV2FsbGV0U3RhdHVzLldBTExFVF9DT05ORUNURUQgPyBkYXRhLndhbGxldHMgOiBbXSxcbiAgICAgICksXG4gICAgKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjcmVjaGVja1N0YXR1cyAqL1xuICByZWNoZWNrU3RhdHVzID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uPy5yZWNoZWNrU3RhdHVzKCk7XG4gICAgfVxuICB9O1xuXG4gIC8qKiBAc2VlIFdhbGxldCNpbnN0YWxsICovXG4gIGluc3RhbGwgPSAodHlwZTogQ29ubmVjdFR5cGUpID0+IHtcbiAgICBpZiAodHlwZSA9PT0gQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTikge1xuICAgICAgd2luZG93Lm9wZW4oQ0hST01FX0VYVEVOU0lPTl9JTlNUQUxMX1VSTCwgJ19ibGFuaycpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QpIHtcbiAgICAgIGNvbnN0IHdlYkV4dGVuc2lvblN0YXR1cyA9IHRoaXMud2ViQ29ubmVjdG9yPy5nZXRMYXN0U3RhdHVzKCk7XG4gICAgICBpZiAoXG4gICAgICAgIHdlYkV4dGVuc2lvblN0YXR1cz8udHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5OT19BVkFJTEFCTEUgJiZcbiAgICAgICAgd2ViRXh0ZW5zaW9uU3RhdHVzLmluc3RhbGxMaW5rXG4gICAgICApIHtcbiAgICAgICAgd2luZG93Lm9wZW4od2ViRXh0ZW5zaW9uU3RhdHVzLmluc3RhbGxMaW5rLCAnX2JsYW5rJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihgQ29ubmVjdFR5cGUgXCIke3R5cGV9XCIgZG9lcyBub3Qgc3VwcG9ydCBpbnN0YWxsKCkgZnVuY3Rpb25gKTtcbiAgICB9XG4gIH07XG5cbiAgLyoqIEBzZWUgV2FsbGV0I2Nvbm5lY3QgKi9cbiAgY29ubmVjdCA9ICh0eXBlOiBDb25uZWN0VHlwZSkgPT4ge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSBDb25uZWN0VHlwZS5SRUFET05MWTpcbiAgICAgICAgY29uc3QgbmV0d29ya3M6IE5ldHdvcmtJbmZvW10gPSBPYmplY3Qua2V5cyhcbiAgICAgICAgICB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzLFxuICAgICAgICApLm1hcCgoY2hhaW5JZCkgPT4gdGhpcy5vcHRpb25zLndhbGxldENvbm5lY3RDaGFpbklkc1srY2hhaW5JZF0pO1xuXG4gICAgICAgIGNvbnN0IGNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbiA9XG4gICAgICAgICAgdGhpcy5vcHRpb25zLmNyZWF0ZVJlYWRvbmx5V2FsbGV0U2Vzc2lvbj8uKG5ldHdvcmtzKSA/P1xuICAgICAgICAgIHJlYWRvbmx5V2FsbGV0TW9kYWwoeyBuZXR3b3JrcyB9KTtcblxuICAgICAgICBjcmVhdGVSZWFkb25seVdhbGxldFNlc3Npb24udGhlbigocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSA9PiB7XG4gICAgICAgICAgaWYgKHJlYWRvbmx5V2FsbGV0U2Vzc2lvbikge1xuICAgICAgICAgICAgdGhpcy5lbmFibGVSZWFkb25seVdhbGxldChyZUNvbm5lY3QocmVhZG9ubHlXYWxsZXRTZXNzaW9uKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1Q6XG4gICAgICAgIHRoaXMuZW5hYmxlV2FsbGV0Q29ubmVjdCh3Y0Nvbm5lY3QodGhpcy5vcHRpb25zKSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBDb25uZWN0VHlwZS5DSFJPTUVfRVhURU5TSU9OOlxuICAgICAgICB0aGlzLmNocm9tZUV4dGVuc2lvbiEuY29ubmVjdCgpLnRoZW4oKHN1Y2Nlc3MpID0+IHtcbiAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhpcy5lbmFibGVDaHJvbWVFeHRlbnNpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1Q6XG4gICAgICAgIHRoaXMuZW5hYmxlV2ViRXh0ZW5zaW9uKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIENvbm5lY3RUeXBlIWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjY29ubmVjdFJlYWRvbmx5ICovXG4gIGNvbm5lY3RSZWFkb25seSA9ICh0ZXJyYUFkZHJlc3M6IHN0cmluZywgbmV0d29yazogTmV0d29ya0luZm8pID0+IHtcbiAgICB0aGlzLmVuYWJsZVJlYWRvbmx5V2FsbGV0KFxuICAgICAgcmVDb25uZWN0KHtcbiAgICAgICAgdGVycmFBZGRyZXNzLFxuICAgICAgICBuZXR3b3JrLFxuICAgICAgfSksXG4gICAgKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjZGlzY29ubmVjdCAqL1xuICBkaXNjb25uZWN0ID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldCA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiA9IG51bGw7XG5cbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcblxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFdFQl9FWFRFTlNJT05fQ09OTkVDVEVEX0tFWSk7XG4gICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjcG9zdCAqL1xuICBwb3N0ID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8VHhSZXN1bHQ+ID0+IHtcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBjaHJvbWUgZXh0ZW5zaW9uIC0gbGVnYWN5IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGlmICh0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIGlmICghdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBjaHJvbWVFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiAoXG4gICAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uXG4gICAgICAgICAgLy8gVE9ETyBtYWtlIFdhbGxldENvbm5lY3RUeFJlc3VsdCB0byBjb21tb24gdHlwZVxuICAgICAgICAgIC5wb3N0PENyZWF0ZVR4T3B0aW9ucywgeyByZXN1bHQ6IFdhbGxldENvbm5lY3RUeFJlc3VsdCB9Pih0eClcbiAgICAgICAgICAudGhlbigoeyBwYXlsb2FkIH0pID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnR4LFxuICAgICAgICAgICAgICByZXN1bHQ6IHBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvbkNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93IG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4RmFpbGVkKHR4LCBlcnJvci50eGhhc2gsIGVycm9yLm1lc3NhZ2UsIG51bGwpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIENocm9tZUV4dGVuc2lvblVuc3BlY2lmaWVkRXJyb3IpIHtcbiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBVc2VyRGVuaWVkRXJyb3JcbiAgICAgICAgICAgIC8vIEFsbCB1bnNwZWNpZmllZCBlcnJvcnMuLi5cbiAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyB3ZWIgZXh0ZW5zaW9uIC0gbmV3IGV4dGVuc2lvblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIGVsc2UgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFR4UmVzdWx0PigocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGlmICghdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKGB3ZWJFeHRlbnNpb24gaW5zdGFuY2Ugbm90IGNyZWF0ZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHdlYkV4dGVuc2lvblN0YXRlcyA9IHRoaXMud2ViQ29ubmVjdG9yLmdldExhc3RTdGF0ZXMoKTtcblxuICAgICAgICBpZiAoIXdlYkV4dGVuc2lvblN0YXRlcykge1xuICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoYHdlYkV4dGVuc2lvbi5nZXRMYXN0U3RhdGVzKCkgcmV0dXJucyB1bmRlZmluZWQhYCkpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSB0eFRhcmdldC50ZXJyYUFkZHJlc3NcbiAgICAgICAgICA/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzLmZpbmQoXG4gICAgICAgICAgICAgIChpdGVtV2FsbGV0KSA9PiBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT0gdHhUYXJnZXQudGVycmFBZGRyZXNzLFxuICAgICAgICAgICAgKSA/PyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXVxuICAgICAgICAgIDogd2ViRXh0ZW5zaW9uU3RhdGVzLmZvY3VzZWRXYWxsZXRBZGRyZXNzXG4gICAgICAgICAgPyB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0cy5maW5kKFxuICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICBpdGVtV2FsbGV0LnRlcnJhQWRkcmVzcyA9PT1cbiAgICAgICAgICAgICAgICB3ZWJFeHRlbnNpb25TdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICApID8/IHdlYkV4dGVuc2lvblN0YXRlcy53YWxsZXRzWzBdXG4gICAgICAgICAgOiB3ZWJFeHRlbnNpb25TdGF0ZXMud2FsbGV0c1swXTtcblxuICAgICAgICBjb25zdCBzdWJzY3JpcHRpb24gPSB0aGlzLndlYkNvbm5lY3RvclxuICAgICAgICAgIC5wb3N0KGZvY3VzZWRXYWxsZXQudGVycmFBZGRyZXNzLCB0eClcbiAgICAgICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgICAgIG5leHQ6IChleHRlbnNpb25UeFJlc3VsdDogV2ViQ29ubmVjdG9yVHhSZXN1bHQpID0+IHtcbiAgICAgICAgICAgICAgc3dpdGNoIChleHRlbnNpb25UeFJlc3VsdC5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICBjYXNlIFdlYkNvbm5lY3RvclR4U3RhdHVzLlNVQ0NFRUQ6XG4gICAgICAgICAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdDogZXh0ZW5zaW9uVHhSZXN1bHQucGF5bG9hZCxcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVXNlckRlbmllZCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgVXNlckRlbmllZCgpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdlYkNvbm5lY3RvckNyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBDcmVhdGVUeEZhaWxlZCh0eCwgZXJyb3IubWVzc2FnZSkpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2ViQ29ubmVjdG9yVHhGYWlsZWQpIHtcbiAgICAgICAgICAgICAgICByZWplY3QoXG4gICAgICAgICAgICAgICAgICBuZXcgVHhGYWlsZWQoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICBlcnJvci50eGhhc2gsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlamVjdChcbiAgICAgICAgICAgICAgICAgIG5ldyBUeFVuc3BlY2lmaWVkRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgICAgICAnbWVzc2FnZScgaW4gZXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gd2FsbGV0IGNvbm5lY3RcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBlbHNlIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHJldHVybiB0aGlzLndhbGxldENvbm5lY3RcbiAgICAgICAgLnBvc3QodHgpXG4gICAgICAgIC50aGVuKFxuICAgICAgICAgIChyZXN1bHQpID0+XG4gICAgICAgICAgICAoe1xuICAgICAgICAgICAgICAuLi50eCxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgfSBhcyBUeFJlc3VsdCksXG4gICAgICAgIClcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGxldCB0aHJvd0Vycm9yID0gZXJyb3I7XG5cbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdFVzZXJEZW5pZWQpIHtcbiAgICAgICAgICAgICAgdGhyb3dFcnJvciA9IG5ldyBVc2VyRGVuaWVkKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgV2FsbGV0Q29ubmVjdENyZWF0ZVR4RmFpbGVkKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgQ3JlYXRlVHhGYWlsZWQodHgsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUeEZhaWxlZCkge1xuICAgICAgICAgICAgICB0aHJvd0Vycm9yID0gbmV3IFR4RmFpbGVkKFxuICAgICAgICAgICAgICAgIHR4LFxuICAgICAgICAgICAgICAgIGVycm9yLnR4aGFzaCxcbiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIGVycm9yLnJhd19tZXNzYWdlLFxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciBpbnN0YW5jZW9mIFdhbGxldENvbm5lY3RUaW1lb3V0KSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVGltZW91dChlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IgaW5zdGFuY2VvZiBXYWxsZXRDb25uZWN0VHhVbnNwZWNpZmllZEVycm9yKSB7XG4gICAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICAgIHRocm93RXJyb3IgPSBuZXcgVHhVbnNwZWNpZmllZEVycm9yKFxuICAgICAgICAgICAgICB0eCxcbiAgICAgICAgICAgICAgJ21lc3NhZ2UnIGluIGVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRocm93IHRocm93RXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIGFyZSBubyBjb25uZWN0aW9ucyB0aGF0IGNhbiBiZSBwb3N0aW5nIHR4IWApO1xuICAgIH1cbiAgfTtcblxuICAvKiogQHNlZSBXYWxsZXQjc2lnbiAqL1xuICBzaWduID0gYXN5bmMgKFxuICAgIHR4OiBDcmVhdGVUeE9wdGlvbnMsXG4gICAgLy8gVE9ETyBub3Qgd29yayBhdCB0aGlzIHRpbWUuIGZvciB0aGUgZnV0dXJlIGV4dGVuc2lvblxuICAgIHR4VGFyZ2V0OiB7IHRlcnJhQWRkcmVzcz86IHN0cmluZyB9ID0ge30sXG4gICk6IFByb21pc2U8U2lnblJlc3VsdD4gPT4ge1xuICAgIGludGVyZmFjZSBTaWduUmVzdWx0UmF3IGV4dGVuZHMgQ3JlYXRlVHhPcHRpb25zIHtcbiAgICAgIHJlc3VsdDoge1xuICAgICAgICBwdWJsaWNfa2V5OiBzdHJpbmcgfCBQdWJsaWNLZXkuRGF0YTtcbiAgICAgICAgcmVjaWQ6IG51bWJlcjtcbiAgICAgICAgc2lnbmF0dXJlOiBzdHJpbmc7XG4gICAgICAgIHN0ZFNpZ25Nc2dEYXRhOiBTdGRTaWduTXNnLkRhdGE7XG4gICAgICB9O1xuICAgICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICBpZiAoIXRoaXMuY2hyb21lRXh0ZW5zaW9uKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgY2hyb21lRXh0ZW5zaW9uIGluc3RhbmNlIG5vdCBjcmVhdGVkIWApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5jaHJvbWVFeHRlbnNpb25cbiAgICAgICAgLnNpZ248Q3JlYXRlVHhPcHRpb25zLCBTaWduUmVzdWx0UmF3Pih0eClcbiAgICAgICAgLnRoZW4oKHsgcGF5bG9hZCB9KSA9PiB7XG4gICAgICAgICAgY29uc3QgcHVibGljS2V5OiBQdWJsaWNLZXkuRGF0YSA9XG4gICAgICAgICAgICB0eXBlb2YgcGF5bG9hZC5yZXN1bHQucHVibGljX2tleSA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgPyB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAndGVuZGVybWludC9QdWJLZXlTZWNwMjU2azEnLFxuICAgICAgICAgICAgICAgICAgdmFsdWU6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA6IHBheWxvYWQucmVzdWx0LnB1YmxpY19rZXk7XG5cbiAgICAgICAgICBjb25zdCBzaWduUmVzdWx0OiBTaWduUmVzdWx0WydyZXN1bHQnXSA9IHtcbiAgICAgICAgICAgIC4uLnBheWxvYWQucmVzdWx0LFxuICAgICAgICAgICAgcHVibGljX2tleTogcHVibGljS2V5LFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4udHgsXG4gICAgICAgICAgICByZXN1bHQ6IHNpZ25SZXN1bHQsXG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBDaHJvbWVFeHRlbnNpb25DcmVhdGVUeEZhaWxlZCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IENyZWF0ZVR4RmFpbGVkKHR4LCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVHhGYWlsZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBUeEZhaWxlZCh0eCwgZXJyb3IudHhoYXNoLCBlcnJvci5tZXNzYWdlLCBudWxsKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yIGluc3RhbmNlb2YgQ2hyb21lRXh0ZW5zaW9uVW5zcGVjaWZpZWRFcnJvcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IFR4VW5zcGVjaWZpZWRFcnJvcih0eCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFVzZXJEZW5pZWQgLSBjaHJvbWUgZXh0ZW5zaW9uIHdpbGwgc2VudCBvcmlnaW5hbCBVc2VyRGVuaWVkIGVycm9yIHR5cGVcbiAgICAgICAgICAvLyBBbGwgdW5zcGVjaWZpZWQgZXJyb3JzLi4uXG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgc2lnbigpIG1ldGhvZCBvbmx5IGF2YWlsYWJsZSBvbiBjaHJvbWUgZXh0ZW5zaW9uYCk7XG4gICAgLy8gVE9ETyBpbXBsZW1lbnRzIHNpZ24oKSB0byBvdGhlciBjb25uZWN0IHR5cGVzXG4gIH07XG5cbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICAvLyBpbnRlcm5hbFxuICAvLyBjb25uZWN0IHR5cGUgY2hhbmdpbmdcbiAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICBwcml2YXRlIHVwZGF0ZVN0YXRlcyA9IChuZXh0OiBXYWxsZXRTdGF0ZXMpID0+IHtcbiAgICBjb25zdCBwcmV2ID0gdGhpcy5fc3RhdGVzLmdldFZhbHVlKCk7XG5cbiAgICBpZiAoXG4gICAgICBuZXh0LnN0YXR1cyA9PT0gV2FsbGV0U3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgIG5leHQud2FsbGV0cy5sZW5ndGggPT09IDBcbiAgICApIHtcbiAgICAgIGNvbnNvbGUudHJhY2UoJz8/PycpO1xuICAgIH1cblxuICAgIGlmIChwcmV2LnN0YXR1cyAhPT0gbmV4dC5zdGF0dXMgfHwgIWRlZXBFcXVhbChwcmV2LCBuZXh0KSkge1xuICAgICAgdGhpcy5fc3RhdGVzLm5leHQobmV4dCk7XG4gICAgfVxuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlUmVhZG9ubHlXYWxsZXQgPSAocmVhZG9ubHlXYWxsZXQ6IFJlYWRvbmx5V2FsbGV0Q29udHJvbGxlcikgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVdhbGxldENvbm5lY3Q/LigpO1xuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbj8uKCk7XG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uPy4oKTtcblxuICAgIGlmIChcbiAgICAgIHRoaXMucmVhZG9ubHlXYWxsZXQgPT09IHJlYWRvbmx5V2FsbGV0IHx8XG4gICAgICAodGhpcy5yZWFkb25seVdhbGxldD8udGVycmFBZGRyZXNzID09PSByZWFkb25seVdhbGxldC50ZXJyYUFkZHJlc3MgJiZcbiAgICAgICAgdGhpcy5yZWFkb25seVdhbGxldC5uZXR3b3JrID09PSByZWFkb25seVdhbGxldC5uZXR3b3JrKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJlYWRvbmx5V2FsbGV0KSB7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0LmRpc2Nvbm5lY3QoKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gcmVhZG9ubHlXYWxsZXQ7XG5cbiAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgbmV0d29yazogcmVhZG9ubHlXYWxsZXQubmV0d29yayxcbiAgICAgIHdhbGxldHM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbm5lY3RUeXBlOiBDb25uZWN0VHlwZS5SRUFET05MWSxcbiAgICAgICAgICB0ZXJyYUFkZHJlc3M6IHJlYWRvbmx5V2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICBkZXNpZ246ICdyZWFkb25seScsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kaXNhYmxlUmVhZG9ubHlXYWxsZXQgPSAoKSA9PiB7XG4gICAgICByZWFkb25seVdhbGxldC5kaXNjb25uZWN0KCk7XG4gICAgICB0aGlzLnJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVDaHJvbWVFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbiB8fCAhdGhpcy53ZWJDb25uZWN0b3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMud2ViQ29ubmVjdG9yLnN0YXR1cygpLFxuICAgICAgdGhpcy53ZWJDb25uZWN0b3Iuc3RhdGVzKCksXG4gICAgXSkuc3Vic2NyaWJlKChbc3RhdHVzLCBzdGF0ZXNdKSA9PiB7XG4gICAgICBpZiAoIXN0YXRlcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5SRUFEWSkge1xuICAgICAgICBpZiAoc3RhdGVzLndhbGxldHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IGZvY3VzZWRXYWxsZXQgPSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3NcbiAgICAgICAgICAgID8gc3RhdGVzLndhbGxldHMuZmluZChcbiAgICAgICAgICAgICAgICAoaXRlbVdhbGxldCkgPT5cbiAgICAgICAgICAgICAgICAgIGl0ZW1XYWxsZXQudGVycmFBZGRyZXNzID09PSBzdGF0ZXMuZm9jdXNlZFdhbGxldEFkZHJlc3MsXG4gICAgICAgICAgICAgICkgPz8gc3RhdGVzLndhbGxldHNbMF1cbiAgICAgICAgICAgIDogc3RhdGVzLndhbGxldHNbMF07XG5cbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogc3RhdGVzLm5ldHdvcmssXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuV0VCX0NPTk5FQ1QsXG4gICAgICAgICAgICAgICAgdGVycmFBZGRyZXNzOiBmb2N1c2VkV2FsbGV0LnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICBkZXNpZ246IGZvY3VzZWRXYWxsZXQuZGVzaWduLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChzdGF0dXMudHlwZSA9PT0gV2ViQ29ubmVjdG9yU3RhdHVzVHlwZS5OT19BVkFJTEFCTEUpIHtcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcblxuICAgICAgICBpZiAoIXN0YXR1cy5pc0FwcHJvdmVkICYmIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbikge1xuICAgICAgICAgIHRoaXMuZGlzYWJsZVdlYkV4dGVuc2lvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShXRUJfRVhURU5TSU9OX0NPTk5FQ1RFRF9LRVksICd0cnVlJyk7XG5cbiAgICBjb25zdCBsYXN0RXh0ZW5zaW9uU3RhdHVzID0gdGhpcy53ZWJDb25uZWN0b3IuZ2V0TGFzdFN0YXR1cygpO1xuXG4gICAgaWYgKFxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy50eXBlID09PSBXZWJDb25uZWN0b3JTdGF0dXNUeXBlLk5PX0FWQUlMQUJMRSAmJlxuICAgICAgbGFzdEV4dGVuc2lvblN0YXR1cy5pc0FwcHJvdmVkID09PSBmYWxzZVxuICAgICkge1xuICAgICAgdGhpcy53ZWJDb25uZWN0b3IucmVxdWVzdEFwcHJvdmFsKCk7XG4gICAgfVxuXG4gICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oV0VCX0VYVEVOU0lPTl9DT05ORUNURURfS0VZKTtcbiAgICAgIGV4dGVuc2lvblN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgdGhpcy5kaXNhYmxlV2ViRXh0ZW5zaW9uID0gbnVsbDtcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgZW5hYmxlQ2hyb21lRXh0ZW5zaW9uID0gKCkgPT4ge1xuICAgIHRoaXMuZGlzYWJsZVJlYWRvbmx5V2FsbGV0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0Py4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiB8fCAhdGhpcy5jaHJvbWVFeHRlbnNpb24pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBleHRlbnNpb25TdWJzY3JpcHRpb24gPSBjb21iaW5lTGF0ZXN0KFtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnN0YXR1cygpLFxuICAgICAgdGhpcy5jaHJvbWVFeHRlbnNpb24ubmV0d29ya0luZm8oKSxcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uLnRlcnJhQWRkcmVzcygpLFxuICAgIF0pLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoW3N0YXR1cywgbmV0d29ya0luZm8sIHRlcnJhQWRkcmVzc10pID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIHN0YXR1cyA9PT0gQ2hyb21lRXh0ZW5zaW9uU3RhdHVzLldBTExFVF9DT05ORUNURUQgJiZcbiAgICAgICAgICB0eXBlb2YgdGVycmFBZGRyZXNzID09PSAnc3RyaW5nJyAmJlxuICAgICAgICAgIEFjY0FkZHJlc3MudmFsaWRhdGUodGVycmFBZGRyZXNzKVxuICAgICAgICApIHtcbiAgICAgICAgICB0aGlzLnVwZGF0ZVN0YXRlcyh7XG4gICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgbmV0d29yazogbmV0d29ya0luZm8sXG4gICAgICAgICAgICB3YWxsZXRzOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25uZWN0VHlwZTogQ29ubmVjdFR5cGUuQ0hST01FX0VYVEVOU0lPTixcbiAgICAgICAgICAgICAgICB0ZXJyYUFkZHJlc3MsXG4gICAgICAgICAgICAgICAgZGVzaWduOiAnZXh0ZW5zaW9uJyxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy51cGRhdGVTdGF0ZXModGhpcy5fbm90Q29ubmVjdGVkKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9ICgpID0+IHtcbiAgICAgIHRoaXMuY2hyb21lRXh0ZW5zaW9uPy5kaXNjb25uZWN0KCk7XG4gICAgICBleHRlbnNpb25TdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuZGlzYWJsZUNocm9tZUV4dGVuc2lvbiA9IG51bGw7XG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIGVuYWJsZVdhbGxldENvbm5lY3QgPSAod2FsbGV0Q29ubmVjdDogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIpID0+IHtcbiAgICB0aGlzLmRpc2FibGVSZWFkb25seVdhbGxldD8uKCk7XG4gICAgdGhpcy5kaXNhYmxlQ2hyb21lRXh0ZW5zaW9uPy4oKTtcbiAgICB0aGlzLmRpc2FibGVXZWJFeHRlbnNpb24/LigpO1xuXG4gICAgaWYgKHRoaXMud2FsbGV0Q29ubmVjdCA9PT0gd2FsbGV0Q29ubmVjdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLndhbGxldENvbm5lY3QpIHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdC5kaXNjb25uZWN0KCk7XG4gICAgfVxuXG4gICAgdGhpcy53YWxsZXRDb25uZWN0ID0gd2FsbGV0Q29ubmVjdDtcblxuICAgIGNvbnN0IHN1YnNjcmliZVdhbGxldENvbm5lY3QgPSAoXG4gICAgICB3YzogV2FsbGV0Q29ubmVjdENvbnRyb2xsZXIsXG4gICAgKTogU3Vic2NyaXB0aW9uID0+IHtcbiAgICAgIHJldHVybiB3Yy5zZXNzaW9uKCkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKHN0YXR1cykgPT4ge1xuICAgICAgICAgIHN3aXRjaCAoc3RhdHVzLnN0YXR1cykge1xuICAgICAgICAgICAgY2FzZSBXYWxsZXRDb25uZWN0U2Vzc2lvblN0YXR1cy5DT05ORUNURUQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFdhbGxldFN0YXR1cy5XQUxMRVRfQ09OTkVDVEVELFxuICAgICAgICAgICAgICAgIG5ldHdvcms6XG4gICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnMud2FsbGV0Q29ubmVjdENoYWluSWRzW3N0YXR1cy5jaGFpbklkXSA/P1xuICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRlZmF1bHROZXR3b3JrLFxuICAgICAgICAgICAgICAgIHdhbGxldHM6IFtcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdFR5cGU6IENvbm5lY3RUeXBlLldBTExFVENPTk5FQ1QsXG4gICAgICAgICAgICAgICAgICAgIHRlcnJhQWRkcmVzczogc3RhdHVzLnRlcnJhQWRkcmVzcyxcbiAgICAgICAgICAgICAgICAgICAgZGVzaWduOiAnd2FsbGV0Y29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgIHRoaXMudXBkYXRlU3RhdGVzKHRoaXMuX25vdENvbm5lY3RlZCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCB3YWxsZXRDb25uZWN0U2Vzc2lvblN1YnNjcmlwdGlvbiA9XG4gICAgICBzdWJzY3JpYmVXYWxsZXRDb25uZWN0KHdhbGxldENvbm5lY3QpO1xuXG4gICAgdGhpcy5kaXNhYmxlV2FsbGV0Q29ubmVjdCA9ICgpID0+IHtcbiAgICAgIHRoaXMud2FsbGV0Q29ubmVjdD8uZGlzY29ubmVjdCgpO1xuICAgICAgdGhpcy53YWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICAgIHdhbGxldENvbm5lY3RTZXNzaW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICB0aGlzLmRpc2FibGVXYWxsZXRDb25uZWN0ID0gbnVsbDtcbiAgICB9O1xuICB9O1xufVxuIl19